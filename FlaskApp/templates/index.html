<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Monitor OctoPrint</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="/static/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="/static/css/style.min.css" rel="stylesheet">
    <!-- Estilos Creados -->
    <link href="/static/css/estilos.css" rel="stylesheet">


     <!-- JQuery -->
    <script type="text/javascript" src="/static/js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="/static/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="/static/js/mdb.min.js"></script>
   
    <script type="text/javascript">
      function confirmacionDesconectar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas desconectar la maquina?")
        var desconectar= "/desconectar?maq=";
        var direccion = desconectar.concat(maquina);
        if (ask){
          window.alert("Se va a desconectar la maquina");
          window.location.href = direccion;
        }
        
      } 
    </script>

    <script type="text/javascript">
      function confirmacionConectar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas conectar la maquina?")
        var conectar= "/conectar?maq=";
        var direccion = conectar.concat(maquina);
        if (ask){
          window.alert("Se va a conectar la maquina");
          window.location.href = direccion;
        }
        
      } 
    </script>
    <script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>


<!-- <script>
     $.get("/update", function(data) { 
      var refreshId = setInterval(function(){

      $("#pruebaDiv").load(data)
        }, 10000 );
  });
    
</script>  -->


<!--     <script>
      $(document).ready(function() {
       $.ajax(url_for('/')).done(function (reply) {
              $('pruebaDiv').html(reply);
        }, 5000);
      });

</script> -->

    <script type="text/javascript">
      setTimeout(function(){
      window.location.replace("http://127.0.0.1:5000/");
    }, 3000);

    </script>

<!--     <script>
  $.get("/", function(data) { 
      //data contains the response data. update a div to contain the data, or do something else.
      $("#pruebaDiv").html(data);
  });
    
</script> -->


<!--    <script>
  $(document).ready(function(data) { 
      var refreshId = setInterval(function(){
      $("#pruebaDiv").html(data);//actualizas el div
        }, 5000 );
      //data contains the response data. update a div to contain the data, or do something else. 
  });
    
</script>  -->



<!-- <script type="text/javascript">
  $(document).ready(function() { 
  $("#pruebaDiv").load("update");
});
</script> -->


  
</head>


    <!--Main Navigation-->
     <header>
            <!-- Navbar -->
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark  scrolling-navbar">
                <div class="container">

                    <!-- Brand -->
                    <a class="navbar-brand waves-effect" href="http://abadiatecnologica.es/" target="_blank"><strong>Abadía Tecnológica</strong></a>


                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                     <!-- Links -->
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item">
                                <a class="nav-link  waves-effect" href="#">Witbox Negra</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link  waves-effect" href="#">Witbox Amarilla</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link waves-effect" href="#">Witbox Blanca</a>
                            </li>
                             <li class="nav-item">
                                <a class="nav-link waves-effect" href="#">Replicator 2</a>
                            </li>
                             <li class="nav-item">
                                <a class="nav-link waves-effect" href="#">i3 Steel</a>
                            </li>
                             <li class="nav-item">
                                <a class="nav-link waves-effect" href="#">Sirius</a>
                            </li>
                             <li class="nav-item">
                                <a class="nav-link waves-effect" href="#">BlackBelt</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
              

         </div>
     </section>
            <!--Intro Section-->
    
                    <div class="container flex-center">
                        <div class="d-flex align-items-center content-height">
                            <div class="row flex-center pt-5 mt-3">
                            </div>
                        </div>
                    </div>
             </div>
         </section>

        </header>
    <!--Main Navigation-->
	
 
              <div class="container">
              </div>
    <!--Main layout-->
     <body id="body">


 						&nbsp;

        <div class="container">
            <!--Section: Cards-->
            <section class="text-center">

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">
                  {% for key,element in nombresOrdenados.items() %}
                    {% if element == "4" %}
                      <div class="row mb-4 wow fadeIn">
                      <div class="col-lg-3 col-md-12 mb-3">
                    {% else %}
                    <!--Grid column-->
                        <div class="col-lg-3 col-md-12 mb-3">
                      {% endif %}

            
                      
                        <!--<div>{{key}}: {{datosJob[key]["Estado"]}}</div>-->
                      

                      


<!--Primera Impresora -->
                      <!--Card-->
                        <div  class="card">

                            <!--Card image-->
                            
                            <!--Card content-->
                            <div  class="card">


            {% if datosJob[key] %}
            {% if datosJob[key]["Estado"] == "Operational"%}
              <div id="gradOperativa" class="card">
                 <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
            {% elif datosJob[key]["Estado"] == "Printing" %}
              <div id="gradImprime" class="card">
                   <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
            {% else %}
              <div id="gradError" class="card">
                   <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
            {% endif %} 

              {% for element in datosFiles[key] %}
                  <!--pre>{{element}}</pre-->
              {% endfor %}   

             {% if datosJob[key]["Estado"] == "Operational"%}
                 <a href="#" style= <button onclick="confirmacionDesconectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonDisconnect"><i class="fa fa-toggle-off" style="font-size:24px"></i></a>

             {% elif datosJob[key]["Estado"] == "Printing" %}
                 <a href="#" style= <button onclick="confirmacionDesconectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonDisconnect"><i class="fa fa-toggle-off" style="font-size:24px"></i></button></a>
             {% else %}
                 <a href="#" style= <button onclick="confirmacionConectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonConnect"><i class="fa fa-toggle-on" style="font-size:24px"></i></button></a>
             {% endif %} 
          
            
              
               {% if datosJob[key] %}
                  <!--pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Tiempo estimado de impresion: {{datosJob[key]["TiempoEstimadoImpresion"]}}</pre-->
                 {% if datosJob[key] %}
                  <!--pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Tiempo estimado de impresion: {{datosJob[key]["TiempoEstimadoImpresion"]}}</pre-->
                  <p>   </p>
                  <pre> <i class="fa fa-plug"  style="font-size: 24px"></i> : {{datosJob[key]["Estado"]}}</pre>
                  {% if datosJob[key]["TiempoUltimaImpresion"] == 'None' %}
                    <pre> <i class="fa fa-clock-o iconos"></i> Ultima:</pre>
                  {% else %}
                    <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Ultima: {{datosJob[key]["TiempoUltimaImpresion"]}}</pre>
                  {% endif %}
                  
                  {% if datosJob[key]["Nombre"] == 'None' %}
                      <pre> <i class="fa fa-archive" style="font-size:24px"></i></pre>
                  {% else %}
                       <pre> <i class="fa fa-archive" style="font-size:24px"></i> :<span style="font-size: 12px">{{datosJob[key]["Nombre"][:30]}} </span></pre>
                  {% endif %}     
                  {% if datosJob[key]["Porcentaje"] == 'None'%}
                      <pre> <i class="fa fa-percent" style="font-size:24px"></i></pre>
                  {% elif datosJob[key]["Porcentaje"] == '100' %}
                      <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:3]}}%
                        </div>
                      </div>
                  {% else %}

                    <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:4]}}%
                        </div>
                      </div>
                      <pre></pre>
                 {% endif %} 

                {% endif %}     
                  <!--pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Tiempo de impresion: {{datosJob[key]["TiempoImpresion"]}}</pre-->
                  {% if datosJob[key]["TiempoRestante"] == 'None' %}

                      <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Restante: </pre>
                  {% else %}
                      <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Restante: {{datosJob[key]["TiempoRestante"]}} </pre>
                  {% endif %}
                   
                {% else %}
                  <pre> Impresora no conectada </pre>

                {% endif %}   


                {% if datosPrinter[key] %}
                  <!--pre> <i class="fa fa-pause" style="font-size:24px"></i> Pausa: {{datosPrinter[key]["Pausa"]}}</pre-->
                  <!--pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Imprimiendo: {{datosPrinter[key]["Imprimiendo"]}}</pre-->
                  <!--pre> <i class="fa fa-check" style="font-size:24px"></i> Lista: : {{datosPrinter[key]["Lista"]}}</pre-->
                  <!--pre> <i class="fa fa-plug" style="font-size:24px"></i> Estado: {{datosPrinter[key]["Estado"]}}</pre-->
                  <!--pre>Temperatura actual de la cama: {{datosPrinter[key]["TempCamaActual"]}}</pre>
                  <pre>Temperatura fijada de la cama: {{datosPrinter[key]["TempCamaFijada"]}}</pre-->
                  
<!--Comprobacion cuando es una Witbox (sin cama caliente) -->
                  {% if key == "maq1" %}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                  {% elif key == "maq2"%}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>  
                  {% elif key == "maq3"%}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>  
                  {% else %}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                      <pre> <i class="fa fa-thermometer-quarter" style="font-size:24px"></i> Cama: {{datosPrinter[key]["TempCamaActual"]}} / {{datosPrinter[key]["TempCamaFijada"]}} º C</pre>
                  {% endif %}
                  <!--pre> <i class="fa fa-thermometer-empty" style="font-size:24px"></i> Temperatura fijada del extrusor: {{datosPrinter[key]["TempHottendFijada"]}}</pre-->  
                  {% else %}
                  <pre> Impresora no conectada </pre>

                {% endif %}    
            
              {{fallos[key]}}
           
           
          </div>
          {% else %}
          <div style="background-color:#FF7043; class="card h-100">
               
                    
                  <div class="card-body">
                     <h4 class="card-title">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
                    <pre>No hay OctoPrint</pre>
        
          </div>
          </div>
          {% endif %}
                            </div>

                        </div>
                        <!--/.Card-->

                    </div>
                    <!--Grid column-->
                    {% endfor %}

 <!-- Acaban las impresoras -->       

                <!--Grid row-->

            <!--Section: Cards-->

        </div>

    </main>
    <!-- Div del container -->
</div>
    <!--Main layout-->
</body>

    <!--Footer-->

    <footer id="footer">

        <hr class="my-2">

        <!--Copyright-->
        <div class="footer-copyright py-1">
            <span id="copyleft">&copy;</span>
            <span>Copyleft: </span>
            <a style="color: white" href="http://abadiatecnologica.es"> Abadía Tecnológica </a>
        </div>
        <!--/.Copyright-->

    </footer>
    <!--/.Footer-->

</body>
</html>