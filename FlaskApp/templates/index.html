<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Monitor OctoPrint</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="/static/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="/static/css/style.min.css" rel="stylesheet">
    <!-- Estilos Creados -->
    <link href="/static/css/estilos.css" rel="stylesheet">


     <!-- JQuery -->
    <script type="text/javascript" src="/static/js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="/static/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="/static/js/mdb.min.js"></script>
   
    <script type="text/javascript">
      function confirmacionDesconectar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas desconectar la maquina?")
        var desconectar= "/desconectar?maq=";
        var direccion = desconectar.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>

    <script type="text/javascript">
      function confirmacionConectar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas conectar la maquina?")
        var conectar= "/conectar?maq=";
        var direccion = conectar.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>

      <script type="text/javascript">
      function confirmacionStart(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas comenzar la impresion?")
        var imprimir= "/imprimir?maq=";
        var direccion = imprimir.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>


      <script type="text/javascript">
      function confirmacionPausar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas pausar la impresion?")
        var pausar= "/pausar?maq=";
        var direccion = pausar.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>

      <script type="text/javascript">
      function confirmacionCancelar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas cancelar la impresion?")
        var cancelar = "/cancelar?maq=";
        var direccion = cancelar.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>

     <script type="text/javascript">
      function confirmacionReanudar(maquina) {
        var ask = window.confirm("¿Estas seguro que deseas reanudar la impresion?")
        var reanudar = "/reanudar?maq=";
        var direccion = reanudar.concat(maquina);
        if (ask){
          window.location.href = direccion;
        }
        
      } 
    </script>


    <script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>


<!-- <script>
     $.get("/update", function(data) { 
      var refreshId = setInterval(function(){

      $("#pruebaDiv").load(data)
        }, 10000 );
  });
    
</script>  -->


<!--     <script>
      $(document).ready(function() {
       $.ajax(url_for('/')).done(function (reply) {
              $('pruebaDiv').html(reply);
        }, 5000);
      });

</script> -->

    <script type="text/javascript">
      setTimeout(function(){
      window.location.replace("./");
    },5000);

    </script>

<!--     <script>
  $.get("/", function(data) { 
      //data contains the response data. update a div to contain the data, or do something else.
      $("#pruebaDiv").html(data);
  });
    
</script> -->


<!--    <script>
  $(document).ready(function(data) { 
      var refreshId = setInterval(function(){
      $("#pruebaDiv").html(data);//actualizas el div
        }, 5000 );
      //data contains the response data. update a div to contain the data, or do something else. 
  });
    
</script>  -->



<!-- <script type="text/javascript">
  $(document).ready(function() { 
  $("#pruebaDiv").load("update");
});
</script> -->


  
</head>


    <!--Main Navigation-->
     <header>
            <!-- Navbar -->
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark  scrolling-navbar">
                <div class="container">

                    <!-- Brand -->
                    <a class="navbar-brand waves-effect" href="http://abadiatecnologica.es/" target="_blank"><strong>Abadía Tecnológica</strong></a>


                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                     <!-- Links -->
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                           {% for key,element in nombresOrdenados.items() %}
                            <li class="nav-item">
                                <a class="nav-link  waves-effect" href={{nombresMaquinas[key]["direccion"]}}>{{nombresMaquinas[key]["Nombre"]}}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </nav>
              

         </div>
     </section>
            <!--Intro Section-->
    
                    <div class="container flex-center">
                        <div class="d-flex align-items-center content-height">
                            <div class="row flex-center pt-5 mt-3">
                            </div>
                        </div>
                    </div>
             </div>
         </section>

        </header>
    <!--Main Navigation-->
	
 
              <div class="container">
              </div>
    <!--Main layout-->
     <body id="body">


 						&nbsp;

        <div class="container">
            <!--Section: Cards-->
            <section class="text-center">

                <!--Grid row-->
                <div class="row mb-4 wow fadeIn">
                  {% for key,element in datosJob.items() %}
                    {% if element == "4" %}
                      <div class="row mb-4 wow fadeIn">
                      <div class="col-lg-3 col-md-12 mb-3">
                    {% else %}
                    <!--Grid column-->
                        <div class="col-lg-3 col-md-12 mb-3">
                      {% endif %}

            
                      
                        <!--<div>{{key}}: {{datosJob[key]["Estado"]}}</div>-->
                    

<!--Primera Impresora -->
                      <!--Card-->
                        <div  class="card">

                            <!--Card image-->
                            
                            <!--Card content-->
                            <div  class="card">


            {% if datosJob[key] %} <!--Comprobamos que tenemos el servicio de Octoprint lanzado -->

            {% if datosJob[key]["Estado"] == "Operational"%} <!-- Estado Operativa -->
              <div id="gradOperativa" class="card">
                <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
             	<p>   </p>
             	<!--Estado e icono de desconectar -->

                <pre> <i class="fa fa-plug"  style="font-size: 24px"></i> : {{datosJob[key]["Estado"]}}   <a href="#" style= <button onclick="confirmacionDesconectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonDisconnect"><i class="fa fa-toggle-off" style="font-size:24px"></i></a> </pre>
                <!--Tiempo de ultima impresion -->	
                {% if datosJob[key]["TiempoUltimaImpresion"] != 'None' %}
                    <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Ultima: {{datosJob[key]["TiempoUltimaImpresion"]}}</pre>
                {% endif %}
                <!--Nombre del ultimo archivo que ha impreso -->
                {% if datosJob[key]["Nombre"] != 'None' %}
                      <pre> <i class="fa fa-archive" style="font-size:24px"></i> :<span style="font-size: 12px">{{datosJob[key]["Nombre"][:30]}} </span></pre> 
                {% endif %} 
                <!--Porcentaje de impresion -->
                {% if datosJob[key]["Porcentaje"] == 'None'%}
                      
                {% elif datosJob[key]["Porcentaje"] == '100.0' %}

                      <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:3]}}%
                        </div>
                      </div>
                {% else %}
                    <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:4]}}%
                        </div>
                      </div>
                      <pre></pre>
                {% endif %} 

                <!--Temperaturas de la cama y el extrusor -->
                {% if datosPrinter[key] %}
                  
					<!--Comprobacion cuando es una Witbox (sin cama caliente) -->
					{% if datosPrinter[key]["CamaDisponible"] == "No"%}
	 					<pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
	                {% else %}
	                    <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
	                    {% if datosPrinter[key]["TempCamaActual"] > "0.0" %}
	                    	<pre> <i class="fa fa-thermometer-quarter" style="font-size:24px"></i> Cama: {{datosPrinter[key]["TempCamaActual"]}} / {{datosPrinter[key]["TempCamaFijada"]}} º C</pre>
	                    {% endif %}
	                {% endif %}
                  {% else %} <!-- En este caso, el servicio del OctoPrint esta funcionando, pero ha habido algun error -->
                  <pre> Impresora no conectada </pre>

                {% endif %}    
            
             <!-- {{fallos[key]}}-->

             <!-- Empezar a imprimir si hay gcode cargado (Botonera) -->
             <div class="btn-group btn-group" role="group" style="text-align: center;">
              <p>
                  <button type="button" class="btn btn-primary" style="padding: 8px;" onclick="confirmacionStart({{nombresMaquinas[key]["numMaquina"]}})"> <i class="fa fa-print" style="font-size:24px"></i></button>
                  <button type="button" class="btn disabled" style="padding: 8px;" onclick="confirmacionPausar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-pause" style="font-size:24px;color: black"></i></button>
                  <button type="button"class="btn disabled" style="padding: 8px;"onclick="confirmacionCancelar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-stop" style="font-size:24px; color: black"></i></button></p>
             </div>
           

              	
            {% elif datosJob[key]["Estado"] == "Printing" %} <!--Estado imprimiendo -->
              <div id="gradImprime" class="card">
                   <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>

              <p>   </p>
             	<!--Estado e icono de desconectar -->
                <pre> <i class="fa fa-plug"  style="font-size: 24px"></i> : {{datosJob[key]["Estado"]}}   <a href="#" style= <button onclick="confirmacionDesconectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonDisconnect"><i class="fa fa-toggle-off" style="font-size:24px;color: black"></i></a> </pre>
                <!--Tiempo restante de impresion -->	 
                  {% if datosJob[key]["TiempoRestante"] == "None" %}
                  {% elif datosJob[key]["TiempoRestante"] == "0:00:00" %}
                  {% elif datosJob[key]["TiempoRestante"] == "-"%}
                  {% else %}
                
                  <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Restante: {{datosJob[key]["TiempoRestante"]}} </pre>
                  {% endif %}
                <!--Nombre del ultimo archivo que ha impreso -->
                {% if datosJob[key]["Nombre"] != 'None' %}
                      <p> <i class="fa fa-archive" style="font-size:24px"></i> :<span style="font-size: 12px"> {{datosJob[key]["Nombre"]}} </span></p> 
                {% endif %} 
                <!--Porcentaje de impresion -->
                {% if datosJob[key]["Porcentaje"] == 'None'%}
                      
                {% elif datosJob[key]["Porcentaje"] == '100.0' %}

                      <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:3]}}%
                        </div>
                      </div>
                {% else %}
                    <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:4]}}%
                        </div>
                      </div>
                      <pre></pre>
                {% endif %} 

                <!--Temperaturas de la cama y el extrusor -->
                {% if datosPrinter[key] %}
                  
					<!--Comprobacion cuando es una Witbox (sin cama caliente) -->
					{% if datosPrinter[key]["CamaDisponible"] == "No"%}
            <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                  {% else %}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                      {% if datosPrinter[key]["TempCamaActual"] > "0.0" %}
                        <pre> <i class="fa fa-thermometer-quarter" style="font-size:24px"></i> Cama: {{datosPrinter[key]["TempCamaActual"]}} / {{datosPrinter[key]["TempCamaFijada"]}} º C</pre>
                      {% endif %}
                  {% endif %}
                  {% else %} <!-- En este caso, el servicio del OctoPrint esta funcionando, pero ha habido algun error -->
                  <pre> Impresora no conectada </pre>

                {% endif %}  

            <!-- Pusar o Cancelar impresion (Botonera) -->
             <div class="btn-group btn-group" role="group" style="text-align: center;">
              <p>
                  <button type="button" class="btn disabled" style="padding: 8px;" onclick="confirmacionStart({{nombresMaquinas[key]["numMaquina"]}})"> <i class="fa fa-print" style="font-size:24px;color: black"></i></button>
                  <button type="button" class="btn btn-warning" style="padding: 8px;" onclick="confirmacionPausar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-pause" style="font-size:24px"></i></button>
                  <button type="button"class="btn btn-danger" style="padding: 8px;"onclick="confirmacionCancelar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-stop" style="font-size:24px"></i></button></p>
             </div>
             <!-- {{fallos[key]}}-->



              <!-- Cuando el estado es Pausa -->
              {% elif datosJob[key]["Estado"] == "Paused" %} 
                            <div id="gradPausa" class="card">
                   <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>

              <p>   </p>
              <!--Estado e icono de desconectar -->
                <pre> <i class="fa fa-plug"  style="font-size: 24px"></i> : {{datosJob[key]["Estado"]}}   <a href="#" style= <button onclick="confirmacionDesconectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonDisconnect"><i class="fa fa-toggle-off" style="font-size:24px;color: black"></i></a> </pre>
                <!--Tiempo restante de impresion -->   
                  {% if datosJob[key]["TiempoRestante"] == "None" %}
                  {% elif datosJob[key]["TiempoRestante"] == "0:00:00" %}
                  {% elif datosJob[key]["TiempoRestante"] == "-"%}
                  {% else %}
                
                  <pre> <i class="fa fa-clock-o" style="font-size:24px"></i> Restante: {{datosJob[key]["TiempoRestante"]}} </pre>
                  {% endif %}
                <!--Nombre del ultimo archivo que ha impreso -->
                {% if datosJob[key]["Nombre"] != 'None' %}
                      <p> <i class="fa fa-archive" style="font-size:24px"></i> :<span style="font-size: 12px"> {{datosJob[key]["Nombre"]}} </span></p> 
                {% endif %} 
                <!--Porcentaje de impresion -->
                {% if datosJob[key]["Porcentaje"] == 'None'%}
                      
                {% elif datosJob[key]["Porcentaje"] == '100.0' %}

                      <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:3]}}%
                        </div>
                      </div>
                {% else %}
                    <div id="progressBar">

                        <div id="progress-bar"  role="progressbar"  aria-valuemin="0" aria-valuemax="100" style="width:{{datosJob[key]["Porcentaje"]}}%">
                        {{datosJob[key]["Porcentaje"][:4]}}%
                        </div>
                      </div>
                      <pre></pre>
                {% endif %} 

                <!--Temperaturas de la cama y el extrusor -->
                {% if datosPrinter[key] %}
                  
          <!--Comprobacion cuando es una Witbox (sin cama caliente) -->
          {% if datosPrinter[key]["CamaDisponible"] == "No"%}
            <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                  {% else %}
                      <pre> <i class="fa fa-thermometer" style="font-size:24px"></i> Extrusor: {{datosPrinter[key]["TempHottendActual"]}} / {{datosPrinter[key]["TempHottendFijada"]}} º C</pre>
                      {% if datosPrinter[key]["TempCamaActual"] > "0.0" %}
                        <pre> <i class="fa fa-thermometer-quarter" style="font-size:24px"></i> Cama: {{datosPrinter[key]["TempCamaActual"]}} / {{datosPrinter[key]["TempCamaFijada"]}} º C</pre>
                      {% endif %}
                  {% endif %}
                  {% else %} <!-- En este caso, el servicio del OctoPrint esta funcionando, pero ha habido algun error -->
                  <pre> Impresora no conectada </pre>

                {% endif %}  

            <!-- Pusar o Cancelar impresion (Botonera) -->
             <div class="btn-group btn-group" role="group" style="text-align: center;">
              <p>
                  <button type="button" class="btn disabled" style="padding: 8px;" onclick="confirmacionStart({{nombresMaquinas[key]["numMaquina"]}})"> <i class="fa fa-print" style="font-size:24px;color: black"></i></button>
                  <button type="button" class="btn btn-warning" style="padding: 8px;" onclick="confirmacionReanudar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-play" style="font-size:24px"></i></button>
                  <button type="button"class="btn btn-danger" style="padding: 8px;"onclick="confirmacionCancelar({{nombresMaquinas[key]["numMaquina"]}})" > <i class="fa fa-stop" style="font-size:24px"></i></button></p>
             </div>

              <!-- Cuando tenemos el dato por defecto significa que el servicio de OctoPrint no esta lanzado.-->
              {% elif datosJob[key]["Estado"] == "-" %} 

              <div id="gradError" class="card">
                <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
                </h4>
               <p> El servicio de OctoPrint no esta en funcionamiento. </p>
               <i class="fa fa-exclamation-triangle" style="font-size: 48px"></i>


            {% else %} <!-- Cuando el Octoprint funciona pero ha dado algun error -->
              <div id="gradError" class="card">
                   <h4 class="card">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
              <a href="#" style= <button onclick="confirmacionConectar({{nombresMaquinas[key]["numMaquina"]}})" class="buttonConnect"><i class="fa fa-toggle-on" style="font-size:24px"></i></button></a>
               <p> <i class="fa fa-plug"  style="font-size: 24px"></i> : {{datosJob[key]["Estado"]}}</p>

            {% endif %} 

              {% for element in datosFiles[key] %}
                  <!--pre>{{element}}</pre-->
              {% endfor %}   


              </div>
         

          {% else %}
          <div style="background-color:#FF7043; class="card h-100">
               
                    
                  <div class="card-body">
                     <h4 class="card-title">
                <a href={{nombresMaquinas[key]["direccion"]}} style = "color:black">{{nombresMaquinas[key]["Nombre"]}}</a>
              </h4>
                    <pre>No hay OctoPrint</pre>
        
          </div>
          </div>
          {% endif %}
                            </div>

                        </div>
                        <!--/.Card-->

                    </div>
                    <!--Grid column-->
                    {% endfor %}

 <!-- Acaban las impresoras -->       

                <!--Grid row-->

            <!--Section: Cards-->

        </div>

    </main>
    <!-- Div del container -->
</div>
    <!--Main layout-->
</body>

    <!--Footer-->

    <footer id="footer">

        <hr class="my-2">

        <!--Copyright-->
        <div class="footer-copyright py-1">
            <span id="copyleft">&copy;</span>
            <span>Copyleft: </span>
            <a style="color: white" href="http://abadiatecnologica.es"> Abadía Tecnológica </a>
        </div>
        <!--/.Copyright-->

    </footer>
    <!--/.Footer-->

</body>
</html>